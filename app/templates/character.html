{% extends "base.html" %}
{% block title %} {{character.model}} {% endblock %}
{% block javascript %} <script src="{{url_for('static', filename='scripts/character.js')}}" defer></script> {% endblock %}
{% block css %} <link rel="stylesheet" href="{{url_for('static', filename='styles/character.css')}}"> {% endblock %}

{% block body %}
<div id = "main_wrapper" class = "parent wrapper">
    <section class = "back wrapper">
        <a href = "/">Back</a>
        <a href = "/" id = "reset">Reset</a>
    </section>
    <section class = "character wrapper">
        <h2>{{character.name}}: {{character.model}}</h2>
        <img class = "character img" src="{{url_for('static', filename='images/modifiers/' + character.image)}}">
        <div class = "character info">
            <div hidden class ="characterId">{{character.id}}</div>
            <div hidden> Initial Rank: <span class = "character rank">{{character.rank}}</span></div>
            <div class = "character faction">Faction: {{character.genzone}}</div>
            <div class = "character element">Element: {{character.element}}</div>
            <div class = "level "> Level: 
                <input id="characterLevel" class = "character level selector" type="number" value="1" inputmode="numeric" max="80" min="1" />
            </div>
            <div class = "character personal_rank"> Rank: 
                <select class = "character personal_rank selector">
                    <option value="none">None</option>
                    <option value="omega">Î©</option>
                    <option value="SSS">SSS</option>
                    <option value="SS">SS</option>
                    <option value="S">S</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                </select>
            </div>
        </div>
    </section>
    <section class = "sigils wrapper">
        <div class = "sigils container">
            {% for sigil_number in range(6) %}
                <div class = "sigil container" id = "sigil{{sigil_number}}">
                    <h3>Sigil {{sigil_number+1}}</h3>
                    <img class = "sigil img" id="sigil_image_{{sigil_number}}" src="{{url_for('static', filename='images/sigils/' + 'sigil_blank.png')}}">
                    <input class="sigil name" list="brow{{sigil_number}}" onchange="changeSigilImg(this, '{{sigil_number}}')">
                    <datalist id="brow{{sigil_number}}">
                        <option value="None">
                        {% for i in range(sigils | length)%}
                        <option value="{{sigils[i].name}}">
                        {% endfor %}
                    </datalist>  
                    <div class = "sigil{{sigil_number}} level label">Level: 
                        <input class = "sigil level selector" id="sigil{{sigil_number}}Level" type="number" min="1" max="60" value="1" />
                    </div>
                    <section class = "warp container" id = "warp{{sigil_number}}">
                        {%for i in [1,2] %}
                            <label> Warp Effect {{i}}:
                                <input class = "warp effect" list="brow-{{sigil_number}}-{{i}}" onchange="changeWarp`{{i}}`(this, '{{sigil_number}}')">
                                <datalist id="brow-{{sigil_number}}-{{i}}">
                                    <option value="None">
                                    {% for j in range(warp_skills | length)%}
                                        {% if (sigil_number+1) == warp_skills[j].slot1 or (sigil_number+1) == warp_skills[j].slot2%}
                                            <option value="{{warp_skills[j].name}}">
                                        {% endif %}
                                    {% endfor %}
                                </datalist> 
                            </label>
                        
                            <div class = "warp{{i}} level label">Level: 
                                <input class = "warp level selector" id="sigil{{sigil_number}}_level_{{i}}" type="number" value="0" min="0" max="3" />
                            </div>
                        {% endfor %}
                        
                    </section>
                </div>
            {% endfor %}
        </div>
    </section>
    <section class = "weapon wrapper">
        <h3>Weapon</h3>
        <div class = "weapon container">
            <div class = "weapon level label"> Weapon Level: 
                <input class = "weapon level selector" id="weapon_level" type="number" value="1" min="1" max="60"/>
            </div> 
        </div>
    </section>
    <section class = "skills container">
        <h3>Skills</h3>
        <div class = "skill level"> Normal Attack level: 
            <input class = "skill level selector" id="skillNA" type="number" min="1" max="45"/>
        </div>
        <div class = "skill level"> Skill 1 level: 
            <input class = "skill level selector" id="skill1" type="number" min="1" max="45" />
        </div>
        <div class = "skill level"> Skill 2 level: 
            <input class = "skill level selector" id="skill2" type="number" min="1" max="45" />
        </div>
        <div class = "skill level"> Skill 3 level: 
            <input class = "skill level selector" id="skill3" type="number" min="1" max="45" />
        </div>
        <div class = "skill level"> Ultimate Skill level: 
            <input class = "skill level selector" id="skillU" type="number" min="1" max="45" />
        </div>
        <div class = "skill level"> Dodge Skill level: 1 (current max)</div>
    </section>
    <section id = "percentWrapper" hidden>
        <h3>Progress</h3>
        <p>Completed: 0%</p>
    </section>
</div>


    <script defer>
        async function getSigils() {
            let response = await fetch("/api/sigils")
            return response.json()
        }

        function changeSigilImg(element, sigil_number) {
            var name_input = element.value;
            let elem = document.getElementById("sigil_image_" + sigil_number);

            if (name_input == "" || name_input == "None") {
                elem.src= "{{url_for('static', filename='images/sigils/')}}" + "sigil_blank.png";
                return; 
            }
            let sigils = getSigils().then(sigils => {
                sigils.forEach(option => {
                    if (option.name == name_input) {
                        elem.src= "{{url_for('static', filename='images/sigils/')}}" + option.image;
                    }
                });
            });
        }	

        
        const sigilNames = document.querySelectorAll('.sigil.name');
        function storeSigilNames(){
            let sigilNamesArray = [];
            for (let i=0; i < sigilNames.length; i++){
                sigilNamesArray.push(sigilNames[i].value);
            }
            localStorage.setItem('sigilNames'+`{{character.id}}`, JSON.stringify(sigilNamesArray));
        }

        function loadSigilNames(){
            const savedSigilNames = JSON.parse(localStorage.getItem('sigilNames'+`{{character.id}}`));
            if (savedSigilNames){
                for (let i=0; i < sigilNames.length; i++){
                    sigilNames[i].value = savedSigilNames[i];
                    changeSigilImg(sigilNames[i], i);
                }
            }
        }
        loadSigilNames();

        sigilNames.forEach((elem) => {
            elem.addEventListener('input', () => {
                storeSigilNames();
            });
        });
    </script>

{% endblock %}

